Декомпозиция выбранной архитектуры на функциональные компоненты
=========
|          |                                                                   |
|----------|-------------------------------------------------------------------|
|Status:   | proposed 
|Deciders: | dev, devops                                                       |
|Date:     | 04.07.2023                                                        |

# 1. Кейс

Необходимо декомпозировать выбранную в рамках [ADR-0001](../ADR-0001/README.md) архитектуру на функцональные компоненты

# 2. Модели предметной области 

## 2.1. Модель "Сущность-Связь"  

![](wsd/ER.png)

## 2.2. Модель состояний

### 2.2.1. Для студента
![](wsd/States%20of%20a%20student.png)

### 2.2.2. Для преподавателя
![](wsd/States%20of%20a%20professor.png)

### 2.2.3. Для менеджера
![](wsd/States%20of%20a%20manager.png)

# 3. Функциональная декомпозиция

## 3.1 По взаимодействию с пользователями

- Аутентификация и авторизация
- Сервисы менеджера
- Сервисы преподавателя
- Сервисы студента

### 3.1.1. Аутентификация и авторизация

![](wsd/ER%20Auth.png)


| Метод   | URL                         | Назначение                           |
|---------|-----------------------------|--------------------------------------| 
| POST    |/api/v1/auth/front/login     | Вход                                 |
| POST    |/api/v1/auth/front/logout    | Выход                                |
| GET     |/api/v1/auth/front/profile   | Профиль пользователя                 |
| GET     |/api/v1/auth/back/user       | Что за пользователь по по сессии     |
| GET     |/api/v1/auth/back/permissions| Права пользователя                   |
| POST    |/api/v1/auth/grant           | Назначнеие прав пользователю         |
| POST    |/api/v1/auth/revoke          | Лишение прав пользователя            |


### 3.1.2. Сервисы менеджера

![](wsd/ER%20Manager.png)

| Метод   | URL                                | Назначение                    |
|---------|------------------------------------|-------------------------------| 
| GET     |/api/v1/manager/front/users         | Список пользователей          |
| GET     |/api/v1/manager/front/trainings     | Список курсов                 |
| POST    |/api/v1/manager/front/training/add  | Добавление курса              |
| POST    |/api/v1/manager/front/training/save | Сохранение курса              |
| GET     |/api/v1/manager/front/requests      | Списо заявок                  |
| POST    |/api/v1/manager/front/grant         | Назначить права пользователю  |
| POST    |/api/v1/manager/front/revoke        | Забрать права пользователя    |
| POST    |/api/v1/manager/front/traning/add   | Добавить курс                 |
| POST    |/api/v1/manager/front/traning/save  | Сохранить курс                |
| POST    |/api/v1/manager/front/request/accept| Принять заявку                |
| POST    |/api/v1/manager/front/request/reject| Отклонить заявку              |
| GET     |/api/v1/manager/front/training/sheet| Отчет об успеваемости         |
| GET     |/api/v1/manager/front/certs         | Список сертификатов           |
| GET     |/api/v1/manager/front/cert/get      | Просмотр сертификата          |

### 3.1.3. Сервисы преподавателя

![](wsd/ER%20professor.png)

| Метод   | URL                                    | Назначение                |
|---------|----------------------------------------|---------------------------| 
| GET     |/api/v1/professor/front/trainings       | Список курсов             |
| POST    |/api/v1/professor/front/traning/request | Запрос на ведение курса   |
| GET     |/api/v1/professor/front/tasks           | Список задач курса        |
| GET     |/api/v1/professor/front/task/get        | Просмотр задачи курса     |
| POST    |/api/v1/professor/front/task/add        | Добавление задачи курса   |
| POST    |/api/v1/professor/front/task/save       | Сохранение задачи курса   |
| GET     |/api/v1/professor/front/tests           | Список тестов задачи      |
| GET     |/api/v1/professor/front/test/get        | Просмотр теста задачи     |
| POST    |/api/v1/professor/front/test/add        | Добавление теста задачи   |
| POST    |/api/v1/professor/front/test/save       | Сохранение теста задачи   |
 
### 3.1.4. Сервисы студента

![](wsd/ER%20student.png)

| Метод   | URL                                    | Назначение                |
|---------|----------------------------------------|---------------------------| 
| GET     |/api/v1/student/front/trainings         | Список курсов             |
| POST    |/api/v1/student/front/traning/request   | Запрос учебы на курсе     |
| GET     |/api/v1/student/front/tasks             | Список задач курса        |
| GET     |/api/v1/student/front/task/get          | Просмотр задачи курса     |
| GET     |/api/v1/student/front/decisions         | Список решений задачи     |
| POST    |/api/v1/student/front/decision/add      | Добавление решения        |
| GET     |/api/v1/student/front/decision/check    | Проверка решения          |
| GET     |/api/v1/student/front/certs             | Список сертификатов       |
| GET     |/api/v1/student/front/cert/get          | Просмотр сертификата      |
 

## 3.2. По сущностям системы

- Пользователь
- Учебный курс
- Договор со студентом о прохождении курса
- Договор с преподавателем о ведении курса
- Задача учебного курса
- Тест для задачи учебного курса
- Решение задачи
- Проверка решения
- Отчет об успеваемости
- Сертификат

### 3.2.1. Пользователь

![](wsd/ER%202%20user.png)

| Метод   | URL                         | Назначение                           |
|---------|-----------------------------|--------------------------------------| 
| POST    |/api/v1/user/front/login     | Вход                                 |
| POST    |/api/v1/user/front/logout    | Выход                                |
| GET     |/api/v1/user/front/profile   | Профиль пользователя                 |
| GET     |/api/v1/user/back/permissions| Права пользователя по сессии         |


### 3.2.2. Учебный курс  
![](wsd/ER%202%20training.png)

| Метод   | URL                         | Назначение                           |
|---------|-----------------------------|--------------------------------------| 
| GET     |/api/v1/trainings            | Список курсов                        |
| PUT     |/api/v1/training             | Добавление курса                     |
| GET     |/api/v1/training/{id}        | Получение информации о курсе         |
| POST    |/api/v1/training/{id}        | Редактирование курса                 |
| DELETE  |/api/v1/training/{id}        | Удаление курса                       |


### 3.2.3. Договор со студентом о прохождении курса
![](wsd/ER%202%20student.png)
| Метод   | URL                         | Назначение                           |
|---------|-----------------------------|--------------------------------------| 
| GET     |/api/v1/students             | Список договоров со студентами(заявок|
| PUT     |/api/v1/student/request      | Подача заявки на обучение            |
| GET     |/api/v1/student/request/{id} | Получение информации о заявке        |
| POST    |/api/v1/student/request/{id} | Редактирование заявки студента       |
| DELETE  |/api/v1/student/request/{id} | Удаление заявки студента             |
| POST    |/api/v1/accept/{request_id}  | Одобрение заявки                     |
| POST    |/api/v1/reject/{request_id}  | Отклонение заявки                    |

### 3.2.4. Договор с преподавателем о прохождении курса
![](wsd/ER%202%20professor.png)
| Метод   | URL                          | Назначение                          |
|---------|------------------------------|-------------------------------------| 
| GET     |/api/v1/professor             | Список договоров с преподавателями  |
| PUT     |/api/v1/professor/request     | Подача заявки на преподавание курса |
| GET     |/api/v1/professor/request/{id}| Получение информации о заявке       |
| POST    |/api/v1/professor/request/{id}| Редактирование заявки преподавателя |
| DELETE  |/api/v1/professor/request/{id}| Удаление заявки преподавателя       |
| POST    |/api/v1/accept/{request_id}   | Одобрение заявки                    |
| POST    |/api/v1/reject/{request_id}   | Отклонение заявки                   |

### 3.2.5. Задача учебного курса 
![](wsd/ER%202%20task.png)
| Метод   | URL                           | Назначение                         |
|---------|-------------------------------|------------------------------------| 
| GET     |/api/v1/tasks/{training_id}    | Список задач курса                 |
| PUT     |/api/v1/task/{training_id}     | Подача заявки на преподавание курса|
| GET     |/api/v1/task/{training_id}/{id}| Получение информации о заявке      |
| POST    |/api/v1/task/{training_id}/{id}| Редактирование заявки преподавателя|
| DELETE  |/api/v1/task/{training_id}/{id}| Удаление задачи                    |

### 3.2.6. Тест для задачи учебного курса 
![](wsd/ER%202%20test.png)
| Метод   | URL                          | Назначение                          |
|---------|------------------------------|-------------------------------------| 
| GET     |/api/v1/tests/{task_id}       | Список тестов задачи                |
| PUT     |/api/v1/test/{task_id}        | Создание теста для задачи           |
| GET     |/api/v1/test/{task_id}/{id}   | Получение информации о тесте        |
| POST    |/api/v1/test/{task_id}/{id}   | Редактирование теста для задачи     |
| DELETE  |/api/v1/test/{task_id}/{id}   | Удаление теста для задачи           |

### 3.2.7. Решение задачи 
![](wsd/ER%202%20decision.png)
| Метод   | URL                             | Назначение                       |
|---------|---------------------------------|----------------------------------| 
| GET     |/api/v1/decisions/{task_id}      | Список решений задачи            |
| PUT     |/api/v1/decision/{task_id}/{uuid}| Отправка решения на проверку     |
| GET     |/api/v1/decision/{task_id}/{id}  | Получение информации о решении   |

### 3.2.8 Проверка решения
![](wsd/ER%202%20decision_test.png)
| Метод   | URL                             | Назначение                       |
|---------|---------------------------------|----------------------------------| 
| GET     |/api/v1/decision_tests/{task_id} | Получение отчета об успеваемости |

### 3.2.8 Отчет об успеваемости  
![](wsd/ER%202%20report.png)
| Метод   | URL                             | Назначение                       |
|---------|---------------------------------|----------------------------------| 
| GET     |/api/v1/report/training/{id}     | Список пройденных тестов задачи  |

### 3.2.9. Сертификат

![](wsd/ER%202%20cert.png)
| Метод   | URL                             | Назначение                       |
|---------|---------------------------------|----------------------------------| 
| GET     |/api/v1/certs                    | Список сертификатов студента     |
| GET     |/api/v1/cert/{id}                | Информация о сертификате студента|

# <a name="change_scenario"></a> 
# 4. Сценарии изменения

1. Добавление нового языка программирования, на котором будут подаваться решения
задач (** средняя вероятность) 
2. Добавление новых полей в форму договора на обучение (*** высокая вероятность)
3. Добавление новых полей в форму договора на преподавание (*** высокая вероятность)
4. Добавление новых способов аутентификации, в том числе через ЕСИА (** средняя вероятность)
5. Изменение оформления формы сертификата (* низкая вероятность)
6. Добавление новых условий в описание задачи (например запрет на использование определённого синтаксиса) 
(*** высокая вероятность)
7. Добавление к курсам новых атрибутов (например, дат проведения, скидок и пр.)
(** средняя вероятность)
8. Использование системы для проведения тестирования в других областях (другие 
способы проверки, а не только компиляция и запуск написанного кода) 
( * низкая вероятность)

# 5. Сравнение функциональных декомпозиций

## 5.1 Оценка модифицируемости декомпозиция по взаимодействию с пользователями 

| N | Вероятность сценария изменения           | 3.1.1 | 3.1.2 | 3.1.3 | 3.1.4 |
|---|------------------------------------------|-------|-------|-------|-------|
| 1 | **                                       |   .   |   +   |   .   |   +   |
| 2 | ***                                      |   .   |   +   |   .   |   +   |
| 3 | ***                                      |   .   |   +   |   +   |   .   |
| 4 | **                                       |   +   |   +   |   .   |   .   |
| 5 | *                                        |   .   |   +   |   .   |   +   |
| 6 | ***                                      |       |   +   |   +   |   +   |
| 7 | **                                       |       |   +   |   +   |   +   |
| 8 | *                                        |       |   +   |   +   |   +   |

*+* - указанный компонент потребует изменений 


## 5.2 Оценка модифицируемости декомпозиции по сущностям системы 

| N |в-ть|3.2.1| 3.2.2 | 3.2.3 | 3.2.4 | 3.2.5 | 3.2.6 | 3.2.7 | 3.2.8 | 3.2.9 |
|---|----|-----|-------|-------|-------|-------|-------|-------|-------|-------|
| 1 | ** |  .  |   .   |   .   |   .   |   .   |   +   |   +   |   +   |   .   |
| 2 | ***|  .  |   .   |   +   |   .   |   .   |   .   |   .   |   .   |   .   |
| 3 | ***|  .  |   .   |   .   |   +   |   .   |   .   |   .   |   .   |   .   |
| 4 | ** |  +  |   .   |   .   |   .   |   .   |   .   |   .   |   .   |   .   |
| 5 | *  |  .  |   .   |   .   |   .   |   .   |   .   |   .   |   .   |   +   |
| 6 | ***|  .  |   .   |   .   |   .   |   +   |   .   |   .   |   .   |   .   |
| 7 | ** |  .  |   +   |   .   |   .   |   .   |   .   |   .   |   .   |   .   |
| 8 | *  |  .  |   .   |   .   |   .   |   .   |   +   |   +   |   .   |   .   |

*+* - указанный компонент потребует изменений 

# 6. Выводы

1. Второй способ функционального разбиения (разбиение по сущностям системы) 
предпочтительней первого (по пользовательским потребностям) с точки зрения 
минимизации правок компонентов в рамках указанных сценариев изменения.
2. Второй способ разбиения будучи реализованным в виде микросервисов позволит 
более гибко и точечно масштабировать как производительность системы, так и скорость разработки в требующих того компонентах И развивать функционал.
3. Первый способ функционального разбиения менее трудозатратен и предпочтителен
в случае если систему в ближайшее время не планируется функционально развивать.

В соответствии с бизнес-целями, описанными в  [ADR-0001](../ADR-0001/README.md)
принято решение использовать второй способ функционального разбиения системы
(по сущностям системы).